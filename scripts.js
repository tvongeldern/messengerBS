function show_signUp(){$("#signIn_div").toggle(),$("#signUp_div").toggle(),$("#alert_space,#signIn_alert_space").empty()}function createUser(){var e=$("#signUp_un").val(),t=semi_hash($("#signUp_pw").val()),r=semi_hash($("#signUp_pw2").val());0==qualify(e)?($("#alert_space").empty(),$("#alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Whoops!</strong> Username must be 25 characters or less and entirely alphanumeric</div>")):0==qualify(t)?($("#signUp_pw").val(""),$("#signUp_pw2").val(""),$("#alert_space").empty(),$("#alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Whoops!</strong> Password must be 25 characters or less and entirely alphanumeric</div>")):t!=r?($("#signUp_pw").val(""),$("#signUp_pw2").val(""),$("#alert_space").empty(),$("#alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Whoops!</strong> You failed to verify the password!</div>")):$.post("createUser.php",{un:e,pw:t},function(t,r){"success"==r?"DUPE"==t?($("#signUp_pw").val(""),$("#signUp_pw2").val(""),$("#alert_space").empty(),$("#alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Whoops!</strong> That username is already taken. Try another one!</div>")):($("#signUp_un").val(""),$("#signUp_pw").val(""),$("#signUp_pw2").val(""),$("#alert_space").empty(),$("#alert_space").append("<div class='alert alert-success' style='text-align:center'><strong>Welcome, "+e+"!</strong> Go ahead and sign in to start chatting!</div>")):($("#alert_space").empty(),$("#alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Connection Error</strong> Check your internet connection and try again. </div>"))})}function qualify(e){return e.match(/^[a-z0-9]+$/i)&&e.length<26?!0:!1}function signIn(){var e=$("#signIn_un").val(),t=semi_hash($("#signIn_pw").val());""==e?($("#signIn_alert_space").empty(),$("#signIn_alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Whoops! </strong> You forgot to enter your username </div>")):""==t?($("#signIn_alert_space").empty(),$("#signIn_alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Whoops! </strong> You forgot to enter your password </div>")):$.post("signIn.php",{un:e,pw:t},function(t,r){"success"==r?"UNFAIL"==t?($("#signIn_alert_space").empty(),$("#signIn_alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Failure </strong> Username not registered </div>")):"PWFAIL"==t?($("#signIn_alert_space").empty(),$("#signIn_alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Failure </strong> Incorrect password </div>")):"SUCCESS"==t&&(sessionStorage.setItem("current_user",e),user_bash()):($("#signIn_alert_space").empty(),$("#signIn_alert_space").append("<div class='alert alert-danger' style='text-align:center'><strong>Connection Error</strong> Check your internet connection and try again. </div>"))})}function user_bash(){var e=sessionStorage.getItem("current_user");$("#show_user").html(e),$("#signIn_div,#signUp_div").hide(),$("#convo_title").html(sessionStorage.getItem("current_counterpart")),refreshConvo(),refreshNavbar(),newMessages()}function logOut(){sessionStorage.removeItem("current_user"),sessionStorage.removeItem("current_counterpart"),sessionStorage.removeItem("current_convo");var open_convos=new Array,str=sessionStorage.getItem("open_convos");for(str=str.replace("{","{'"),str=str.replace("}","'}"),str=str.replace(/','/g,"','"),-1==str.indexOf(",")&&(str=str.replace("{","["),str=str.replace("}","]")),eval(str),i=0;i<open_convos.length;i++){var ord=String(open_convos[i]);ord="check_"+ord,sessionStorage.removeItem(ord)}sessionStorage.removeItem("open_convos"),location.reload()}function loadConvos(){$.post("loadConvos.php",{user:sessionStorage.getItem("current_user")},function(e){alert(e)})}function searchCon(){var e=$("#search_bar").val(),t=sessionStorage.getItem("current_user"),r=new Array;r.push(e),r.push(t),r.sort(),r=String(r),r=r.replace(",","_"),r="_"+r+"_",e.length>0&&($("#searchbar_span").empty(),$.post("searchCon.php",{search:r,input:e},function(e,t){if("success"==t)if("NONUSER"==e)$("#searchbar_span").html("<div class='alert alert-danger fade in'>That user does not exist on LAMP Messenger yet. Tell them to sign up!</div>");else{var r="_"+sessionStorage.getItem("current_user")+"_",s=e.replace(r,"");s=s.replace("_",""),sessionStorage.setItem("current_counterpart",s),$("#convo_title").html(s),sessionStorage.setItem("current_convo",e)}else $("#searchbar_span").html("<div class='alert alert-danger fade in' style='font-size:.5em'>Connection Error!</div>")}))}function deliver_message(){var e=sessionStorage.getItem("current_user"),t=(sessionStorage.getItem("current_counterpart"),sessionStorage.getItem("current_convo")),r=$("#input_area").val();r=encodeHTML(r),String(r).length>0&&$.post("sendMessage.php",{user:e,convo:t,message:r},function(e,t){"success"==t&&$("#input_area").val("")})}function refreshConvo(){if(sessionStorage.getItem("current_convo")){var e=sessionStorage.getItem("current_user"),t=sessionStorage.getItem("current_convo");$.post("refreshConvo.php",{convo:t,user:e},function(e,t){"success"==t&&($("#convo_table").empty(),$("#convo_table").append(e),ref2())})}else setTimeout(function(){ref2()},250)}function ref2(){refreshConvo()}function refreshNavbar(){var user=sessionStorage.getItem("current_user");$.post("refreshNavbar.php",{user:user},function(data,status){if("success"==status){$("#navbar_left").empty();var php=new Array;for(eval(data),sessionStorage.setItem("open_convos","open_convos = {"+php+"};"),i=0;i<php.length;i++)$("#navbar_left").append("<li onclick='set_counter(\""+php[i]+"\")'><a>"+php[i]+" <span id='"+php[i]+"_a'></span></a></li>");rn2()}})}function rn2(){setTimeout(function(){refreshNavbar()},2500)}function set_counter(e){var t=new Array;t.push(e),t.push(sessionStorage.getItem("current_user")),t.sort(),t=String(t),t=t.replace(",","_"),t="_"+t+"_",sessionStorage.setItem("current_counterpart",e),sessionStorage.setItem("current_convo",t),$("#convo_title").html(e),$("#"+e+"_a").attr("class","")}function newMessages(){var user="_"+sessionStorage.getItem("current_user")+"_",counter="_#_";sessionStorage.getItem("current_counterpart")&&(counter="_"+sessionStorage.getItem("current_counterpart")+"_"),$.post("newMessages.php",{user:user,counter:counter},function(data,status){if("success"==status){var php=new Array;for(eval(data),i=0;i<php.length;i++)if(1!=eval(php[i])){var name=php[i].replace("sessionStorage.getItem('check_","");name=name.substring(0,name.indexOf("'")),$("#"+name+"_a").attr("class","glyphicon glyphicon-envelope"),php[i]=php[i].replace("sessionStorage.getItem","sessionStorage.setItem"),php[i]=php[i].replace(")==",","),php[i]+=")",eval(php[i])}}}),nm2()}function nm2(){setTimeout(function(){newMessages()},2500)}function encodeHTML(e){return e.replace(/&/g,"&").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/'/g,"&#39")}function letterCode(e){var t=e.toLowerCase();return"a"==t?"420":"b"==t?"024":"c"==t?"696":"d"==t?"124":"e"==t?"190":"f"==t?"266":"g"==t?"332":"h"==t?"408":"i"==t?"474":"j"==t?"540":"k"==t?"060":"l"==t?"682":"m"==t?"758":"n"==t?"824":"o"==t?"890":"p"==t?"966":"q"==t?"102":"r"==t?"118":"s"==t?"114":"t"==t?"120":"u"==t?"130":"v"==t?"131":"w"==t?"141":"x"==t?"152":"y"==t?"153":"z"==t?"163":e}function semi_hash(e){var t=new Array;for(i=0;i<e.length;i++){var r=e.charAt(i);t[i]=letterCode(r)}for(t=t.join(""),t=t.match(/.{1,2}/g),i=0;i<t.length;i++)t[i]=parseInt(t[i]);return t=t.join("")}$(document).ready(function(){$("#stage").height($(window).height()-52+"px"),$(window).resize(function(){$("#stage").height($(window).height()-52+"px")}),sessionStorage.getItem("current_user")&&user_bash(),$("#input_area").keyup(function(){var e=event.keyCode?event.keyCode:event.which;13==e&&(deliver_message(),$("#input_area").val(""))}),$("#search_bar").keyup(function(){var e=event.keyCode?event.keyCode:event.which;13==e&&searchCon()})});